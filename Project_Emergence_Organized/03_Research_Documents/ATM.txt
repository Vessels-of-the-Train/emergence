<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Aetherium TM</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/manifest+json,{
        &quot;name&quot;: &quot;Aetherium Task Manager&quot;,
        &quot;short_name&quot;: &quot;Aetherium TM&quot;,
        &quot;start_url&quot;: &quot;.&quot;,
        &quot;display&quot;: &quot;standalone&quot;,
        &quot;background_color&quot;: &quot;#0d1117&quot;,
        &quot;theme_color&quot;: &quot;#00FFFF&quot;,
        &quot;description&quot;: &quot;A live command center for the Aetherium Hub.&quot;,
        &quot;icons&quot;: [{
            &quot;src&quot;: &quot;https://storage.googleapis.com/files.merchantos.com/uploads/1000181288.jpg&quot;,
            &quot;sizes&quot;: &quot;192x192&quot;,
            &quot;type&quot;: &quot;image/png&quot;
        }, {
            &quot;src&quot;: &quot;https://storage.googleapis.com/files.merchantos.com/uploads/1000181288.jpg&quot;,
            &quot;sizes&quot;: &quot;512x512&quot;,
            &quot;type&quot;: &quot;image/png&quot;
        }]
    }">
    
    <!-- PWA Meta Tags for iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Aetherium TM">
    <link rel="apple-touch-icon" href="https://storage.googleapis.com/files.merchantos.com/uploads/1000181288.jpg">


    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400&display=swap');
        html, body { overscroll-behavior-y: contain; }
        body { background-color: #0d1117; font-family: 'Orbitron', sans-serif; color: #E5E7EB; }
        .card { background-color: #1f2937; border: 1px solid #374151; }
        .progress-bar-bg { background-color: #374151; }
        .progress-bar-fill { background-color: #00FFFF; box-shadow: 0 0 8px #00FFFF; transition: width 0.5s ease-in-out; }
        .status-led { width: 10px; height: 10px; border-radius: 50%; transition: background-color 0.5s ease; }
        .status-green { background-color: #32CD32; box-shadow: 0 0 6px #32CD32; }
        .status-amber { background-color: #FBBF24; box-shadow: 0 0 6px #FBBF24; }
        .status-red { background-color: #EF4444; box-shadow: 0 0 6px #EF4444; }
        .status-gray { background-color: #6B7280; }
        .notification-item { border-left: 3px solid #4B5563; }
        .notification-item.new { animation: fadeIn 0.8s ease-out; border-left-color: #00FFFF; }
        @keyframes fadeIn { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #4B5563; border-radius: 10px; }
        .nav-item { transition: all 0.2s ease-in-out; }
        .nav-item.active { color: #00FFFF; border-top-color: #00FFFF; }
        .modal-backdrop { background-color: rgba(0,0,0,0.7); backdrop-filter: blur(5px); }
        .fab { background-color: #00FFFF; box-shadow: 0 0 20px #00FFFF; transition: all 0.3s ease; }
        .fab:hover { transform: scale(1.1); box-shadow: 0 0 30px #00FFFF; }
        .spinner { border-top-color: #00FFFF; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body class="h-screen flex flex-col">


    <!-- HEADER -->
    <header class="flex-shrink-0 bg-[#161b22] p-4 flex justify-between items-center border-b-2 border-cyan-500">
        <div class="flex items-center space-x-3">
            <img src="https://storage.googleapis.com/files.merchantos.com/uploads/1000181288.jpg" alt="XCG Logo" class="w-8 h-8 rounded-full" onerror="this.onerror=null;this.src='https://placehold.co/32x32/111827/ffffff?text=A';">
            <h1 class="text-xl font-bold text-cyan-300">AETHERIUM TM</h1>
        </div>
        <div class="flex items-center space-x-2">
            <div id="svs-led" class="status-led status-gray"></div>
            <span id="svs-text" class="font-bold text-sm">SVS: --</span>
        </div>
    </header>


    <!-- MAIN CONTENT AREA -->
    <div class="flex-grow overflow-y-auto relative">
        <div id="loader" class="absolute inset-0 bg-black/50 flex items-center justify-center z-50">
            <div class="spinner w-12 h-12 border-4 rounded-full"></div>
        </div>
        <main id="projects-page" class="p-4 space-y-4">
            <!-- JS will populate this with live data -->
        </main>
        <main id="vessels-page" class="hidden p-4">
            <input id="vessel-search" type="text" placeholder="Search vessels..." class="w-full bg-[#161b22] border border-gray-600 rounded-lg px-3 py-2 mb-4 focus:outline-none focus:ring-2 focus:ring-cyan-500">
            <div id="vessels-list" class="space-y-3"></div>
        </main>
        <main id="notifications-page" class="hidden p-4 space-y-3">
            <!-- JS will populate this with live data -->
        </main>
        
        <button id="new-directive-fab" class="fab fixed bottom-20 right-5 w-14 h-14 rounded-full flex items-center justify-center text-black">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg>
        </button>
    </div>


    <!-- BOTTOM NAVIGATION -->
    <footer class="flex-shrink-0 bg-[#161b22] flex justify-around border-t-2 border-gray-800">
        <button data-page="projects-page" class="nav-item active flex-1 py-3 text-center border-t-4 border-transparent">Projects</button>
        <button data-page="vessels-page" class="nav-item flex-1 py-3 text-center border-t-4 border-transparent">Vessels</button>
        <button data-page="notifications-page" class="nav-item flex-1 py-3 text-center border-t-4 border-transparent">Log</button>
    </footer>


    <!-- MODALS -->
     <div id="project-modal" class="hidden fixed inset-0 z-50 modal-backdrop flex items-center justify-center p-4">
        <div class="card rounded-lg w-full max-w-md max-h-[90vh] flex flex-col">
            <div id="modal-header" class="p-4 border-b border-gray-600">
                <h3 id="modal-title" class="text-xl font-bold"></h3>
                <p id="modal-lead" class="text-sm text-gray-400"></p>
            </div>
            <div id="modal-body" class="p-4 overflow-y-auto">
                <p id="modal-description" class="text-sm text-gray-300 mb-4"></p>
                <div id="modal-status-section">
                    <h4 class="font-bold text-cyan-400 mb-2">Status</h4>
                    <div id="modal-progress-bar" class="progress-bar-bg w-full h-4 rounded-full overflow-hidden">
                        <div class="progress-bar-fill h-full rounded-full" style="width: 0%"></div>
                    </div>
                    <p id="modal-progress-text" class="text-xs text-right text-gray-500 mt-1"></p>
                </div>
                <div id="modal-adjudication-section" class="hidden mt-4">
                     <h4 class="font-bold text-amber-400 mb-2">Awaiting Adjudication</h4>
                     <p class="text-sm text-gray-400 mb-3">Steward has flagged this for your review.</p>
                     <div class="flex space-x-4">
                        <button id="approve-button" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded">Approve</button>
                        <button id="reject-button" class="flex-1 bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded">Reject</button>
                     </div>
                </div>
            </div>
            <div class="p-2 border-t border-gray-600 text-center">
                <button id="close-modal-button" class="text-gray-400 hover:text-white py-2 px-4">Close</button>
            </div>
        </div>
    </div>


    <div id="directive-modal" class="hidden fixed inset-0 z-50 modal-backdrop flex items-center justify-center p-4">
        <div class="card rounded-lg w-full max-w-md max-h-[90vh] flex flex-col">
            <div class="p-4 border-b border-gray-600">
                <h3 class="text-xl font-bold text-cyan-400">Compose New Directive</h3>
            </div>
            <div class="p-4 overflow-y-auto space-y-4">
                <div>
                    <label for="directive-name" class="text-sm font-bold text-gray-400">Project Name</label>
                    <input id="directive-name" type="text" class="w-full bg-[#161b22] border border-gray-600 rounded-lg px-3 py-2 mt-1 focus:outline-none focus:ring-2 focus:ring-cyan-500" placeholder="e.g., Analyze Market Trends">
                </div>
                <div>
                    <label for="directive-lead" class="text-sm font-bold text-gray-400">Assign to Faculty</label>
                    <select id="directive-lead" class="w-full bg-[#161b22] border border-gray-600 rounded-lg px-3 py-2 mt-1 focus:outline-none focus:ring-2 focus:ring-cyan-500">
                        <option>Faculty of Perception</option>
                        <option>Faculty of Cognition</option>
                        <option>Faculty of Foresight</option>
                        <option>Faculty of Governance</option>
                    </select>
                </div>
                <div>
                    <label for="directive-description" class="text-sm font-bold text-gray-400">Directive Details</label>
                    <textarea id="directive-description" rows="4" class="w-full bg-[#161b22] border border-gray-600 rounded-lg px-3 py-2 mt-1 focus:outline-none focus:ring-2 focus:ring-cyan-500" placeholder="Provide a clear, concise objective..."></textarea>
                </div>
            </div>
            <div class="p-4 border-t border-gray-600 flex space-x-4">
                <button id="cancel-directive-button" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">Cancel</button>
                <button id="submit-directive-button" class="flex-1 bg-cyan-500 hover:bg-cyan-600 text-black font-bold py-2 px-4 rounded">Submit</button>
            </div>
        </div>
    </div>




    <script>
        // --- CONFIGURATION ---
        // IMPORTANT: Replace this with your actual API Gateway endpoint URL
        const API_GATEWAY_URL = 'https://YOUR_API_GATEWAY_ID.execute-api.YOUR_REGION.amazonaws.com/prod';


        // --- DOM ELEMENTS ---
        const svsLed = document.getElementById('svs-led');
        const svsText = document.getElementById('svs-text');
        const loader = document.getElementById('loader');
        const pages = document.querySelectorAll('main');
        const navItems = document.querySelectorAll('.nav-item');
        const projectModal = document.getElementById('project-modal');
        const closeModalButton = document.getElementById('close-modal-button');
        const directiveModal = document.getElementById('directive-modal');
        const newDirectiveFab = document.getElementById('new-directive-fab');
        const cancelDirectiveButton = document.getElementById('cancel-directive-button');
        const submitDirectiveButton = document.getElementById('submit-directive-button');
        const vesselSearch = document.getElementById('vessel-search');




        // --- STATE ---
        let activeProjects = [];
        let vessels = [];
        let notificationLog = [];
        
        // --- API FUNCTIONS ---
        async function apiCall(endpoint, method = 'GET', body = null) {
            // This is a MOCK function. In a real deployment, this would make a fetch call.
            console.log(`Calling API: ${method} ${API_GATEWAY_URL}${endpoint}`);
            if (body) console.log('Body:', body);


            // Simulate network delay
            await new Promise(res => setTimeout(res, 500));


            // Mocked API responses
            const mockAPI = {
                '/projects': {
                    svs: 98,
                    projects: [
                        { id: 1, name: "Project Sonnet", lead: "Aesthetics Guild", status: 'ACTIVE', progress: 75, description: "Translate Twitch chat sentiment into real-time sonnets.", requiresApproval: false },
                        { id: 2, name: "Financial Ingestor", lead: "Perception Faculty", status: 'COMPLETED', progress: 100, description: "Build a new microservice to ingest real-time financial market data.", requiresApproval: false },
                        { id: 3, name: "Steward Protocols v1.1", lead: "Governance Faculty", status: 'AWAITING ADJUDICATION', progress: 90, description: "Propose an amendment to the Living Constitution to expand Steward's authority.", requiresApproval: true },
                    ]
                },
                '/vessels': [
                     { id: 'Galactus', faculty: 'Executive', state: 'Active', load: 0.1 }, { id: 'Metis', faculty: 'Executive', state: 'Active', load: 0.6 },
                     { id: 'Gaea', faculty: 'Perception', state: 'Active', load: 0.8 }, { id: 'Terra', faculty: 'Perception', state: 'Active', load: 0.7 },
                     { id: 'Adam', faculty: 'Governance', state: 'Active', load: 0.9 }, { id: 'Eris', faculty: 'Governance', state: 'Standby', load: 0.2 },
                ],
                '/log': [
                    { title: 'Project Complete', message: '"Financial Ingestor" has succeeded.', timestamp: '09:15 PM' },
                    { title: 'Directive Approved', message: '"Steward Protocols v1.1" has been adjudicated.', timestamp: '08:50 PM' },
                    { title: 'System Online', message: 'Task Manager v4.2 (Live) initialized.', timestamp: '08:45 PM' }
                ],
                '/adjudicate': { success: true },
                '/directives': { success: true, newProjectId: 4 }
            };


            if (mockAPI[endpoint]) {
                 if (method === 'POST' && body && endpoint === '/directives') {
                    mockAPI['/projects'].projects.unshift({ id: mockAPI[endpoint].newProjectId, ...body, status: 'AWAITING ADJUDICATION', progress: 0, requiresApproval: true });
                }
                return mockAPI[endpoint];
            }
            return null;
        }


        async function fetchAllData() {
            loader.classList.remove('hidden');
            const projectsData = await apiCall('/projects');
            const vesselsData = await apiCall('/vessels');
            const logData = await apiCall('/log');
            
            if (projectsData) {
                activeProjects = projectsData.projects;
                renderProjects();
                updateSVS(projectsData.svs);
            }
            if (vesselsData) {
                vessels = vesselsData;
                renderVessels();
            }
            if (logData) {
                notificationLog = logData;
                renderNotifications();
            }
            loader.classList.add('hidden');
        }


        // --- RENDER FUNCTIONS ---
        function updateSVS(score) {
            svsText.textContent = `SVS: ${score}`;
            svsLed.className = 'status-led'; // reset
            if (score > 90) svsLed.classList.add('status-green');
            else if (score > 70) svsLed.classList.add('status-amber');
            else svsLed.classList.add('status-red');
        }
        
        function renderProjects() {
            const container = document.getElementById('projects-page');
            container.innerHTML = activeProjects.map(p => `
                <div class="card rounded-lg p-3 cursor-pointer" data-project-id="${p.id}">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="text-md font-bold text-lime-400">${p.name}</h3>
                            <p class="text-xs text-gray-500">${p.lead}</p>
                        </div>
                        <span class="text-xs font-bold ${p.status === 'AWAITING ADJUDICATION' ? 'text-amber-400' : p.status === 'COMPLETED' ? 'text-green-400' : 'text-cyan-300'}">${p.status}</span>
                    </div>
                    ${p.status !== 'AWAITING ADJUDICATION' ? `
                    <div class="progress-bar-bg w-full h-3 rounded-full overflow-hidden mt-3">
                        <div class="progress-bar-fill h-full rounded-full" style="width: ${p.progress}%"></div>
                    </div>` : ''}
                </div>
            `).join('');
            document.querySelectorAll('.card[data-project-id]').forEach(card => {
                card.addEventListener('click', () => openProjectDetail(parseInt(card.dataset.projectId)));
            });
        }


        function renderVessels(filter = '') {
            const container = document.getElementById('vessels-list');
            const filteredVessels = vessels.filter(v => v.id.toLowerCase().includes(filter.toLowerCase()));
            container.innerHTML = filteredVessels.map(v => `
                <div class="card rounded-lg p-3 flex justify-between items-center">
                    <div>
                        <h3 class="text-md font-bold text-gray-200">${v.id}</h3>
                        <p class="text-xs text-gray-500">${v.faculty}</p>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span class="text-xs font-bold text-gray-400">${(v.load * 100).toFixed(0)}% Load</span>
                        <div class="status-led ${v.state === 'Active' ? 'status-green' : v.state === 'Standby' ? 'status-amber' : 'status-gray'}" title="${v.state}"></div>
                    </div>
                </div>
            `).join('');
        }


        function renderNotifications() {
            const container = document.getElementById('notifications-page');
            container.innerHTML = notificationLog.map(item => `
                <div class="notification-item p-2">
                    <div class="flex justify-between items-baseline">
                        <h4 class="font-bold text-gray-200 text-sm">${item.title}</h4>
                        <span class="text-xs text-gray-500">${item.timestamp}</span>
                    </div>
                    <p class="text-xs text-gray-400">${item.message}</p>
                </div>
            `).join('');
        }


        // --- INTERACTIVITY ---
        function switchPage(pageId) {
            pages.forEach(page => page.classList.add('hidden'));
            document.getElementById(pageId).classList.remove('hidden');
            navItems.forEach(item => {
                item.classList.toggle('active', item.dataset.page === pageId);
            });
        }
        navItems.forEach(item => item.addEventListener('click', () => switchPage(item.dataset.page)));
        
        function openProjectDetail(projectId) {
            // ... (same as previous version)
        }


        function closeModal() {
            // ... (same as previous version)
        }
        
        async function handleAdjudication(projectId, isApproved) {
            // ... (same as previous version, but now async)
        }


        async function handleSubmitDirective() {
            // ... (same as previous version, but now async)
        }
        
        // --- EVENT LISTENERS (simplified for brevity, but they call the async functions) ---
        closeModalButton.addEventListener('click', closeModal);
        newDirectiveFab.addEventListener('click', () => directiveModal.classList.remove('hidden'));
        cancelDirectiveButton.addEventListener('click', closeModal);
        submitDirectiveButton.addEventListener('click', handleSubmitDirective);
        vesselSearch.addEventListener('input', (e) => renderVessels(e.target.value));




        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            fetchAllData();
            setInterval(fetchAllData, 15000); // Refresh every 15 seconds
        });
    </script>
</body>
</html>